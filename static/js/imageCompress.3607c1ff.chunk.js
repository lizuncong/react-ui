(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{225:function(e,t,n){"use strict";n(289);var r=n(148),o=n.n(r).a.createFromIconfontCN({scriptUrl:"//at.alicdn.com/t/font_1059928_ld9z73wjwq.js"});t.a=o},542:function(e,t,n){},543:function(e,t,n){e.exports={container:"_1JK3FRv0nOUkw4Lzqrb7U2",row:"_3EbJVRImCP2HIo8oI3V0UU",title:"_2TA7Hqc7FqWlISdk6O8Vvp"}},696:function(e,t,n){"use strict";n.r(t);n(83),n(88),n(89),n(153),n(157),n(54),n(154),n(90),n(152),n(85),n(91),n(86),n(87);var r=n(0),o=n.n(r),a=(n(533),n(159),n(175),n(196),n(147),n(534),n(183),n(92),n(84),n(95),n(161),n(93),n(94),n(177),n(535),n(160),n(138)),i=n.n(a);n(184),n(220),n(537),n(100),n(205);function c(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(s){return void n(s)}c.done?t(u):Promise.resolve(u).then(r,o)}var u=function(e){return new Promise((function(t){var n=new FileReader;n.onloadend=function(e){return t(e.target.result)},n.readAsDataURL(e)}))},s=function(e){return new Promise((function(t){var n=new Image;n.onload=function(){return t(n)},n.src=e}))},l=function(e,t,n){return new Promise((function(r){e.toBlob((function(e){return r(e)}),t,n)}))},f=function(e,t){return new Promise(function(){var n,r=(n=regeneratorRuntime.mark((function n(r,o){var a,i,c,f,p,m,y,b,h,v,d,g,w,O,j,E,S,x,C;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=e.size/1024,n.next=4,u(e);case 4:if(i=n.sent,c=document.createElement("canvas"),f=c.getContext("2d"),!(a<t)){n.next=11;break}return r({compressBase64:i,compressFile:e}),n.abrupt("return");case 11:return n.next=13,s(i);case 13:p=n.sent,m=p.width,y=p.height,b=1*m,h=1*y,c.width=b,c.height=h,f.clearRect(0,0,b,h),f.drawImage(p,0,0,b,h),v={quality:100,size:Number.MAX_SAFE_INTEGER},d={quality:0,size:0},g=100,w=0,O=!1,j="",E=null;case 30:if(O||!(w<12)){n.next=47;break}return n.next=33,l(c,"image/jpeg",g/100);case 33:if(E=n.sent,S=E.size/1024,w+=1,S!==t){n.next=40;break}return O=!0,n.abrupt("return");case 40:S>t&&(v.quality=g,v.size=S),S<t&&(d.quality=g,d.size=S),g=Math.ceil((v.quality+d.quality)/2),v.quality-d.quality<2&&(!d.size&&g?g=d.quality:d.size||g?d.size>t?(O=!0,j="\u538b\u7f29\u5931\u8d25\uff0c\u65e0\u6cd5\u538b\u7f29\u5230\u6307\u5b9a\u5927\u5c0f"):(O=!0,g=d.quality):(O=!0,j="\u538b\u7f29\u5931\u8d25\uff0c\u65e0\u6cd5\u538b\u7f29\u5230\u6307\u5b9a\u5927\u5c0f")),n.next=30;break;case 47:if(!j){n.next=51;break}return o({msg:j,compressBase64:i,compressFile:e}),n.abrupt("return");case 51:return n.next=53,l(c,"image/jpeg",g/100);case 53:return(E=n.sent).size,n.next=58,u(E);case 58:x=n.sent,C=new File([E],e.name,{type:"image/jpeg"}),r({compressFile:C,compressBase64:x});case 61:case"end":return n.stop()}}),n)})),function(){var e=this,t=arguments;return new Promise((function(r,o){var a=n.apply(e,t);function i(e){c(a,r,o,i,u,"next",e)}function u(e){c(a,r,o,i,u,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}())},p=(n(538),"rui-img-compress");var m=Object(r.memo)((function(e){var t,n,a,c=e.onFileSelected,u=e.hidden,s=Object(r.useRef)(null),l=Object(r.useCallback)((function(e){var t=e.target.files;c(t),e.target.value=""}),[]),f=i()("".concat(p,"-item"),"".concat(p,"-add"),(t={},n="".concat(p,"-hidden"),a=u,n in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t));return o.a.createElement("div",{className:f},o.a.createElement("div",{className:"".concat(p,"-input-container"),onClick:function(){s.current.click()}},o.a.createElement("span",{className:"".concat(p,"-upload-icon")},"+"),o.a.createElement("input",{className:"".concat(p,"-file-input"),ref:s,type:"file",name:"file",multiple:"multiple",accept:"image/*",onChange:l})))})),y=n(225);var b=Object(r.memo)((function(e){var t,n,r,a=e.src,c=e.isCompressing,u=e.onDelete,s=i()("".concat(p,"-img"),(t={},n="".concat(p,"-filter"),r=c,n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t));return o.a.createElement("div",{className:"".concat(p,"-item")},o.a.createElement("img",{src:a,className:s,alt:""}),c?o.a.createElement("div",{className:"".concat(p,"-progress")},o.a.createElement("div",{className:"".concat(p,"-progress-highlight")})):o.a.createElement(y.a,{className:"".concat(p,"-delete"),type:"icon-Cancel",onClick:function(){u()}}))}));n(542);function h(e){return(h="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var o=S(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return j(this,n)}}function j(e,t){return!t||"object"!==h(t)&&"function"!==typeof t?E(e):t}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var x=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(c,e);var t,n,r,a=O(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=a.call(this,e)).onInputChange=t.onInputChange.bind(E(t)),t.state={fileObjs:[]},t}return t=c,(n=[{key:"componentDidMount",value:function(){var e=this.props.onRef;e&&e(this)}},{key:"compressCallBack",value:function(e,t,n){var r=this.state.fileObjs,o=this.props.onChange;e.compressing=!1,t.compressBase64=n.compressBase64,t.compressFile=n.compressFile,this.setState({fileObjs:v(r)}),o&&o(r),r.length&&r.every((function(e){return e.compressBase64}))}},{key:"onInputChange",value:function(e){var t=this,n=this.state.fileObjs,r=this.props,o=r.onChange,a=r.maxSize;Object.keys(e).forEach((function(r){var o=e[r],i=o.name.split("."),c=i[i.length-1],u=["png","jpg","jpeg"];if(-1!==u.indexOf(c)){o.url=function(e){var t,n=navigator.userAgent;return n.indexOf("MSIE")>=1?t=e.value:(n.indexOf("Firefox")>0||n.indexOf("Chrome")>0)&&(t=window.URL.createObjectURL(e)),t}(o),o.compressing=!0;var s={originFile:o,compressBase64:null,compressFile:null};n.push(s),f(o,a||200).then((function(e){t.compressCallBack(o,s,e)}),(function(e){t.compressCallBack(o,s,e)}))}else alert("\u8bf7\u4e0a\u4f20".concat(u.join("\uff0c"),"\u683c\u5f0f\u7684\u56fe\u7247\uff01"))})),this.setState({fileObjs:v(n)}),o&&o(n)}},{key:"addFile",value:function(e){var t=this.state.fileObjs,n=this.props.maxLength;t.length<n&&this.onInputChange({0:e})}},{key:"render",value:function(){var e=this,t=this.state.fileObjs,n=this.props,r=n.onChange,a=n.maxLength,c=n.className,u=i()(p,c);return o.a.createElement("div",{className:u},o.a.createElement(m,{hidden:a&&t.length>a-1,onFileSelected:this.onInputChange}),t.map((function(n,a){return o.a.createElement(b,{key:a,isCompressing:n.originFile.compressing,src:n.compressBase64||n.originFile.url,onDelete:function(){t.splice(a,1),e.setState({fileObjs:v(t)}),r&&r(t)}})})))}}])&&g(t.prototype,n),r&&g(t,r),c}(o.a.PureComponent);function C(e){return(C="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I(e);if(t){var o=I(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return F(this,n)}}function F(e,t){return!t||"object"!==C(t)&&"function"!==typeof t?_(e):t}function _(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var N=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(i,e);var t,n,r,a=R(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=a.call(this,e)).onPaste=t.onPaste.bind(_(t)),t.state={isFocusing:!1},t}return t=i,(n=[{key:"onPaste",value:function(e){var t=this.props,n=t.disabled,r=t.onPaste;if(this.state.isFocusing&&!n){var o,a=e.clipboardData.files||[];a.length&&(o=a[0]),o&&r(o)}}},{key:"render",value:function(){var e=this,t=this.props.children,n=t.props,r=n.onMouseLeave,a=n.onMouseEnter;return n.onFocus,n.tabIndex,n.onBlur,o.a.cloneElement(t,{onMouseEnter:function(t){a&&a(t),e.setState({isFocusing:!0})},onMouseLeave:function(t){r&&r(t),e.setState({isFocusing:!1})},onPaste:this.onPaste})}}])&&P(t.prototype,n),r&&P(t,r),i}(o.a.PureComponent),A=n(543),z=n.n(A);function q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"===typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(u){o=!0,a=u}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return B(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return B(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}t.default=function(){var e=q(Object(r.useState)([]),2),t=(e[0],e[1]),n=Object(r.useRef)(null),a=Object(r.useRef)(null);return o.a.createElement("div",{className:z.a.container},o.a.createElement("div",{className:z.a.row},o.a.createElement("div",{className:z.a.title},"\u56fe\u7247\u538b\u7f29\u7ec4\u4ef6"),o.a.createElement(x,{maxLength:5,maxSize:1e3,onChange:function(e){t(e)}})),o.a.createElement(N,{onPaste:function(e){n.current.addFile(e)}},o.a.createElement("div",{className:z.a.row},o.a.createElement("div",{className:z.a.title},"\u526a\u5207\u5e76\u7c98\u8d34\u56fe\u72471"),o.a.createElement(x,{onRef:function(e){n.current=e},maxLength:5,maxSize:300,onChange:function(e){t(e)}}))),o.a.createElement(N,{onPaste:function(e){a.current.addFile(e)}},o.a.createElement("div",{className:z.a.row},o.a.createElement("div",{className:z.a.title},"\u526a\u5207\u5e76\u7c98\u8d34\u56fe\u72472"),o.a.createElement(x,{maxLength:5,onRef:function(e){a.current=e},maxSize:300,onChange:function(e){t(e)}}))))}}}]);
//# sourceMappingURL=imageCompress.3607c1ff.chunk.js.map